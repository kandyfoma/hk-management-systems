# Generated by Django 4.2.28 on 2026-02-24 16:20

from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('occupational_health', '0006_accesscontrol_accessrequest_auditlog_complianceaudit_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='SurveillanceProgram',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Ex: Surveillance Respiratoire - Miniers', max_length=200, unique=True, verbose_name='Nom Programme')),
                ('code', models.CharField(help_text='Code unique, ex: SURV_RESP_MIN', max_length=50, unique=True, verbose_name='Code')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('sector', models.CharField(choices=[('mining', 'Minier'), ('construction', 'Construction'), ('manufacturing', 'Fabrication'), ('healthcare', 'Santé'), ('agriculture', 'Agriculture'), ('oil_gas', 'Pétrole & Gaz'), ('transport', 'Transport'), ('other', 'Autre')], max_length=50, verbose_name='Secteur')),
                ('target_risk_group', models.CharField(choices=[('respiratory_exposed', 'Exposition Respiratoire'), ('noise_exposed', 'Exposition Bruit'), ('chemical_exposed', 'Exposition Chimique'), ('heavy_metals', 'Métaux Lourds'), ('night_workers', 'Travail de Nuit'), ('all_workers', 'Tous les Travailleurs'), ('high_risk', 'Risque Élevé')], max_length=50, verbose_name='Groupe Risque Cible')),
                ('required_screenings', models.JSONField(default=list, help_text="Liste des types examen: ex: ['spirometry', 'audiometry']", verbose_name='Examens Requis')),
                ('screening_interval_months', models.PositiveIntegerField(default=12, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(60)], verbose_name='Intervalle Dépistage (mois)')),
                ('action_levels', models.JSONField(default=dict, help_text='Dictionnaire des seuils: {parameter: {warning: X, action: Y, critical: Z}}', verbose_name="Niveaux d'Action")),
                ('is_active', models.BooleanField(default=True, verbose_name='Actif')),
                ('status', models.CharField(choices=[('draft', 'Brouillon'), ('active', 'Actif'), ('paused', 'Suspendu'), ('archived', 'Archivé')], default='active', max_length=20, verbose_name='Statut')),
                ('start_date', models.DateField(auto_now_add=True, verbose_name='Date Début')),
                ('end_date', models.DateField(blank=True, null=True, verbose_name='Date Fin')),
                ('regulatory_reference', models.CharField(blank=True, help_text='Ex: Code Minier RDC Art. 123', max_length=200, verbose_name='Référence Réglementaire')),
                ('compliance_standard', models.CharField(blank=True, help_text='Ex: ISO 45001:2018, ILO C155', max_length=100, verbose_name='Standard Conformité')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveillance_programs_created', to=settings.AUTH_USER_MODEL)),
                ('enterprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='surveillance_programs', to='occupational_health.enterprise')),
            ],
            options={
                'verbose_name': 'Programme Surveillance',
                'verbose_name_plural': 'Programmes Surveillance',
                'ordering': ['enterprise', 'sector'],
            },
        ),
        migrations.CreateModel(
            name='SurveillanceEnrollment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('enrollment_date', models.DateField(auto_now_add=True, verbose_name='Date Inscription')),
                ('reason_for_enrollment', models.CharField(blank=True, help_text='Ex: Nouvelle affectation, exposition détectée', max_length=200, verbose_name='Raison Inscription')),
                ('first_screening_date', models.DateField(blank=True, null=True, verbose_name='Date Premier Dépistage')),
                ('last_screening_date', models.DateField(blank=True, null=True, verbose_name='Dernier Dépistage')),
                ('next_screening_due', models.DateField(blank=True, null=True, verbose_name='Prochain Dépistage Dû')),
                ('compliance_status', models.CharField(choices=[('compliant', 'Conforme'), ('overdue', 'En Retard'), ('non_compliant', 'Non-Conforme'), ('pending', 'En Attente')], default='pending', max_length=20, verbose_name='Statut Conformité')),
                ('screenings_completed', models.PositiveIntegerField(default=0, verbose_name='Dépistages Complétés')),
                ('screenings_missed', models.PositiveIntegerField(default=0, verbose_name='Dépistages Manqués')),
                ('compliance_rate', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Taux Conformité (%)')),
                ('is_active', models.BooleanField(default=True, verbose_name='Actif')),
                ('unenrollment_date', models.DateField(blank=True, null=True, verbose_name='Date Désinscription')),
                ('unenrollment_reason', models.CharField(blank=True, max_length=200, verbose_name='Raison Désinscription')),
                ('clinical_notes', models.TextField(blank=True, verbose_name='Notes Cliniques')),
                ('action_taken', models.TextField(blank=True, verbose_name='Action Prise')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('enrolled_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='worker_enrollments', to=settings.AUTH_USER_MODEL)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enrollments', to='occupational_health.surveillanceprogram')),
                ('worker', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='surveillance_enrollments', to='occupational_health.worker')),
            ],
            options={
                'verbose_name': 'Inscription Surveillance',
                'verbose_name_plural': 'Inscriptions Surveillance',
                'ordering': ['-enrollment_date'],
                'unique_together': {('program', 'worker')},
            },
        ),
        migrations.CreateModel(
            name='ThresholdViolation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('violation_date', models.DateTimeField(auto_now_add=True, verbose_name='Date Violation')),
                ('parameter_tested', models.CharField(help_text='Ex: FEV1 (Spirometry), Lead (Blood)', max_length=200, verbose_name='Paramètre')),
                ('measured_value', models.DecimalField(decimal_places=4, max_digits=10, verbose_name='Valeur Mesurée')),
                ('unit_of_measurement', models.CharField(max_length=50, verbose_name='Unité')),
                ('threshold_value', models.DecimalField(decimal_places=4, max_digits=10, verbose_name='Seuil')),
                ('threshold_type', models.CharField(choices=[('warning', 'Warning'), ('action', 'Action'), ('critical', 'Critical')], max_length=50, verbose_name='Type Seuil')),
                ('percentage_above_threshold', models.DecimalField(decimal_places=2, default=0, max_digits=5, verbose_name='% Au-dessus des Seuils')),
                ('severity', models.CharField(choices=[('warning', 'Avertissement'), ('action', 'Action Requise'), ('critical', 'Critique')], default='warning', max_length=20, verbose_name='Sévérité')),
                ('status', models.CharField(choices=[('open', 'Ouvert'), ('acknowledged', 'Reconnu'), ('in_progress', 'En Cours'), ('resolved', 'Résolu'), ('invalid', 'Non Valide')], default='open', max_length=20, verbose_name='Statut')),
                ('action_required', models.TextField(blank=True, help_text="Recommandation d'action: ex: Référer à spécialiste", verbose_name='Action Requise')),
                ('recommended_followup', models.CharField(blank=True, help_text='Ex: Suivi à 1 mois, Restriction travail', max_length=200, verbose_name='Suivi Recommandé')),
                ('resolution_date', models.DateTimeField(blank=True, null=True, verbose_name='Date Résolution')),
                ('resolution_notes', models.TextField(blank=True, verbose_name='Notes de Résolution')),
                ('acknowledged_date', models.DateTimeField(blank=True, null=True, verbose_name='Date Reconnaissance')),
                ('regulatory_filing_required', models.BooleanField(default=False, verbose_name='Déclaration Réglementaire Requise')),
                ('filed_to_authorities', models.BooleanField(default=False, verbose_name='Déclaré aux Autorités')),
                ('filing_date', models.DateField(blank=True, null=True, verbose_name='Date Déclaration')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('acknowledged_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='violations_acknowledged', to=settings.AUTH_USER_MODEL)),
                ('enrollment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='violations', to='occupational_health.surveillanceenrollment')),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='violations', to='occupational_health.surveillanceprogram')),
                ('related_exam', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='threshold_violations', to='occupational_health.medicalexamination')),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='violations_resolved', to=settings.AUTH_USER_MODEL)),
                ('worker', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='threshold_violations', to='occupational_health.worker')),
            ],
            options={
                'verbose_name': 'Violation Seuil',
                'verbose_name_plural': 'Violations Seuil',
                'ordering': ['-violation_date'],
                'indexes': [models.Index(fields=['worker', '-violation_date'], name='occupationa_worker__b5af17_idx'), models.Index(fields=['program', 'status'], name='occupationa_program_ec86a9_idx'), models.Index(fields=['severity'], name='occupationa_severit_e801c5_idx')],
            },
        ),
        migrations.CreateModel(
            name='ComplianceMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('metrics_date', models.DateField(auto_now_add=True, verbose_name='Date Métrique')),
                ('period', models.CharField(max_length=50, verbose_name='Période')),
                ('total_workers_enrolled', models.PositiveIntegerField(default=0, verbose_name='Total Travailleurs Inscrits')),
                ('active_enrollments', models.PositiveIntegerField(default=0, verbose_name='Inscriptions Actives')),
                ('inactive_enrollments', models.PositiveIntegerField(default=0, verbose_name='Inscriptions Inactives')),
                ('screenings_due', models.PositiveIntegerField(default=0, verbose_name='Dépistages Dus')),
                ('screenings_completed', models.PositiveIntegerField(default=0, verbose_name='Dépistages Complétés')),
                ('screenings_pending', models.PositiveIntegerField(default=0, verbose_name='Dépistages En Attente')),
                ('screenings_overdue', models.PositiveIntegerField(default=0, verbose_name='Dépistages En Retard')),
                ('overall_compliance_rate', models.DecimalField(decimal_places=2, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Taux Conformité Global (%)')),
                ('total_violations', models.PositiveIntegerField(default=0, verbose_name='Total Violations')),
                ('open_violations', models.PositiveIntegerField(default=0, verbose_name='Violations Ouvertes')),
                ('resolved_violations', models.PositiveIntegerField(default=0, verbose_name='Violations Résolues')),
                ('warning_level_violations', models.PositiveIntegerField(default=0, verbose_name='Violations - Avertissement')),
                ('action_level_violations', models.PositiveIntegerField(default=0, verbose_name='Violations - Action')),
                ('critical_level_violations', models.PositiveIntegerField(default=0, verbose_name='Violations - Critique')),
                ('compliant_workers', models.PositiveIntegerField(default=0, verbose_name='Travailleurs Conformes')),
                ('overdue_workers', models.PositiveIntegerField(default=0, verbose_name='Travailleurs En Retard')),
                ('non_compliant_workers', models.PositiveIntegerField(default=0, verbose_name='Travailleurs Non-Conformes')),
                ('pending_workers', models.PositiveIntegerField(default=0, verbose_name='Travailleurs En Attente')),
                ('compliance_rate_previous_period', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Taux Conformité Période Précédente (%)')),
                ('compliance_trend', models.CharField(blank=True, choices=[('improving', 'Improving'), ('stable', 'Stable'), ('declining', 'Declining')], max_length=20, verbose_name='Tendance')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='metrics', to='occupational_health.surveillanceprogram')),
            ],
            options={
                'verbose_name': 'Métrique de Conformité',
                'verbose_name_plural': 'Métriques de Conformité',
                'ordering': ['-metrics_date'],
                'unique_together': {('program', 'metrics_date')},
            },
        ),
    ]
